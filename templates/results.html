
{% extends "layout.html" %}
{% block title %}Results{% endblock %}
 {% block content %}
 <link rel="stylesheet" href="static/results-styles.css" type="text/css">
<body>
    <h1 class="home-title" id="space-out">YOUR FIA RESULTS</h1>
     <div id="loading-message">Loading...</div>
     <div id="outfits-info"></div>
    <div id="forecast-info"></div>
     <!-- Display the images -->
    <div id="forecast-items-container"></div>
     <!-- Add this button -->
    <div class="buttons">
        <button class="button" id="load-more">Load next 5 days</button>
        <button class="button" id="favs-button">View Favorites</button>
    </div>
     <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        city = sessionStorage.getItem('city');
        const gender = sessionStorage.getItem('gender');
        let startDay = 0;
         function loadData() {
            $('#loading-message').show();
             const data = {
                "city": city,
                "gender": gender,
                "startDay": startDay,
            };
             $.ajax({
                url: "/x",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify(data),
                success: function(response) {
                    $('#loading-message').hide();
                    const forecastData = response.forecast;
                    const outfitData = response.outfits;
                     if (forecastData.length !== outfitData.length) {
                        console.error(`Data length mismatch`);
                        return;
                    }
                     const forecastItemsContainer = $("#forecast-items-container");
                    forecastItemsContainer.empty();
                     forecastData.forEach((day, index) => {
                        const temperatureF = day[0];
                        const temperatureC = (temperatureF - 32) * 5 / 9;
                        const weatherDescription = day[1];
                        const precipitation = day[2];
                        const outfitURL = outfitData[index];
                         const dayNumber = startDay + index + 1;
                         const forecastItem = `
                            <div class="forecast-item">
                                <p>Day ${dayNumber}: ${weatherDescription} - ${temperatureC.toFixed(1)}¬∞C/${temperatureF.toFixed(1)}¬∞F</p>
                                <div class="outfit-item">
                                    <img src="${outfitURL}" alt="Outfit Image for Day ${dayNumber}" />
                                    <button class="like-button">ü§ç</button>
                                </div>
                            </div>
                        `;
                        forecastItemsContainer.append(forecastItem);
                    });
                     $('.like-button').click(function() {
                        $(this).toggleClass('liked');
                        if ($(this).hasClass('liked')) {
                            $(this).text('‚ù§Ô∏è');
                        } else {
                            $(this).text('ü§ç');
                        }
                    });
                     startDay += 5;
                },
                error: function(error) {
                    $('#loading-message').hide();
                    console.error('Error fetching data:', error);
                }
            });
        }
         loadData();
        $('#load-more').click(loadData);
    </script>
</body>
{% endblock %}
